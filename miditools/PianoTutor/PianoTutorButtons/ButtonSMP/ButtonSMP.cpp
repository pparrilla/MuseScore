#include "ButtonSMP.h"
#include "Arduino.h"

Button::Button(uint8_t buttonPin, uint8_t buttonMode){
	this->pin=buttonPin;
	pinMode(pin,INPUT_PULLUP);
	buttonMode==PULLDOWN ? pulldown() : pullup();
	state = 0;
	bitWrite(state,CURRENT,!mode);
}

/*
|| Set pin HIGH as default
*/
void Button::pullup(void){
	mode=PULLUP;
	digitalWrite(pin,HIGH);
}

/*
|| Set pin LOW as default
*/
void Button::pulldown(void){
	mode=PULLDOWN;
	//digitalWrite(pin,LOW);
}

/*
|| Return the bitWrite(state,CURRENT, of the switch
*/
bool Button::isPressed(void){
	bitWrite(state,PREVIOUS,bitRead(state,CURRENT));
	if (digitalRead(pin) == mode){
		bitWrite(state,CURRENT,false);
	} else {
		bitWrite(state,CURRENT,true);
	}
	if (bitRead(state,CURRENT) != bitRead(state,PREVIOUS)){
		bitWrite(state,CHANGED,true);
	}else{
		bitWrite(state,CHANGED,false);
	}
	return bitRead(state,CURRENT);
}

/*
|| Return true if the button has been pressed
*/
bool Button::wasPressed(void){
	if (bitRead(state,CURRENT)){
		return true;
	} else {
		return false;
	}
}

/*
|| Return true if state has been changed
*/
bool Button::stateChanged(void){
	return bitRead(state,CHANGED);
}

/*
|| Return true if the button is pressed, and was not pressed before
*/
bool Button::uniquePress(void){
	return (isPressed() && stateChanged());
}